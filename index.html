<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Document</title>
<canvas id=canvas tabindex=0 oncontextmenu=return!1></canvas>
<h4>Use the arrow keys to move the square</h4>
<script src=kan_settings.js></script><script src=Button.js></script><script>let wasm_memory,wasm_func_table;_web_todo("Canvas size: pick some reasonable defaults for width and height, or get them from the canvas by default");let WIDTH,HEIGHT;const canvas=document.querySelector("#canvas"),ctx=canvas.getContext("2d");function _web_get_result_array_ptr(e,t,n){return new e(wasm_memory.buffer,t,n)}function _web_decode_wasm_string(e,t){const n=new Uint8Array(wasm_memory.buffer,e,t);return(new TextDecoder).decode(n)}function _web_invoke_callback(e,...t){wasm_func_table.get(e)(...t)}function _web_todo(e){console.log(`%cTODO: ${e}`,"color: yellow")}function _web_create_css_rgb(e,t,n){return`rgb(${parseInt(e)}, ${parseInt(t)}, ${parseInt(n)})`}let _texture_id=0;const _texture_table={};let _load_promises={};function _platform_asset_texture_loaded(e){return e in _texture_table&&_texture_table[e].loaded}const button_map={w:Button.w,a:Button.a,s:Button.s,d:Button.d,j:Button.j,ArrowLeft:Button.arrow_left,ArrowUp:Button.arrow_up,ArrowRight:Button.arrow_right,ArrowDown:Button.arrow_down," ":Button.space,Escape:Button.esc};console.log("TODO - input not sure how to store buttons in simplest way for platform");const button_state=Array.from({length:Object.values(button_map).length+1}).map(e=>[!1,!1]),max_int=4294967295;function _set_button_state(e,t){const n=button_map[e];if(!n)return;button_state[n][0]=button_state[n][1],button_state[n][1]=t}window.addEventListener("keydown",e=>_set_button_state(e.key,!0)),window.addEventListener("keyup",e=>_set_button_state(e.key,!1)),["_NUMBER_MODE_INT","_NUMBER_MODE_FLOAT","_NUMBER_MODE_HEX"].forEach((e,t)=>window[e]=t);const imports={env:{_platform_number_to_string(e,t,n,s,o){let i;n==_NUMBER_MODE_INT?i=e.toString():n==_NUMBER_MODE_FLOAT?i=e.toFixed(s):n==_NUMBER_MODE_HEX&&(i=e.toString(16));const a=new Uint8Array(wasm_memory.buffer,t);o=Math.min(Math.min(o,a.length),i.length);let r=0;for(let e=0;e<o;e++)a[e]=i.charCodeAt(e),r++;return r},_platform_window_size_set(e,t){WIDTH=e,HEIGHT=t,canvas.width=WIDTH,canvas.height=HEIGHT},_platform_window_size_get(e){const t=new Uint32Array(wasm_memory.buffer,e,2);t[0]=WIDTH,t[1]=HEIGHT},_platform_rand(){return Math.random()},_platform_powf(e,t){return Math.pow(e,t)},_platform_sin(e){return Math.sin(e)},_platform_cos(e){return Math.cos(e)},_platform_fmod(e,t){return e%t},_eval_js(e,t){const n=_web_decode_wasm_string(e,t);eval(n)},_platform_now(){return BigInt(Date.now())},_platform_draw_anti_aliasing_on(e){ctx.imageSmoothingEnabled=e},_platform_draw_clear_screen(e,t,n){ctx.fillStyle=_web_create_css_rgb(e*255,t*255,n*255),ctx.fillRect(0,0,WIDTH,HEIGHT)},_platform_draw_image_2d(e,t,n,s,o,i,a,r,c){const l=_texture_table[c];if(!l)return;const{image:d,width:u,height:h}=l;n=n>0?n:u,s=s>0?s:h,ctx.drawImage(d,e,t,n,s,o,i,n*a,s*r)},_platform_draw_rect_2d(e,t,n,s,o,i,a){ctx.fillStyle=_web_create_css_rgb(o*255,i*255,a*255),ctx.fillRect(e,t,n,s)},_platform_asset_startup_texture_from_file(e,t){const s=_web_decode_wasm_string(e,t);console.log("loading image at:",s),fetch(s).then(e=>e.status);const n=new Image;n.src=s;let a,r;const o=_texture_id++,i=new Promise((e,t)=>{n.onload=function(){const t=n,s=n.naturalWidth,i=n.naturalHeight;_texture_table[o]={image:t,width:s,height:i,loaded:!0},e()},n.onerror=()=>t("file "+s+" does not exist")});return _load_promises[o]=i,o},_platform_asset_texture_loaded,_platform_asset_texture_size(e,t){let n=-1,s=-1;const o=_web_get_result_array_ptr(Int32Array,t,2);let i=!0;if(_platform_texture_loaded(e)){const{width:t,height:o}=_texture_table[e];n=t,s=o,i=!1}return o[0]=n,o[1]=s,i},_call_me_maybe(e){console.log("CB:",e),_web_invoke_callback(e,13),console.log("hello callback")},_platform_print_string(e,t){console.log(_web_decode_wasm_string(e,t))},_platform_console_clear(){console.log(`
`.repeat("25"))},_platform_button_state(e,t){const[s,o]=button_state[e],n=_web_get_result_array_ptr(Int32Array,t,2);n[0]=s,n[1]=o}}};WebAssembly.instantiateStreaming(fetch(KAN_WASM),imports).then(async e=>{_web_todo("_resource_load_image: only support png and maybe a cooked/packed type"),_web_todo("_resource_load_image: add image type to platform side texture?");const t=e.instance.exports;console.log("MODULE:",t),window.gmod=t,wasm_memory=t.memory,wasm_func_table=t.__indirect_function_table,t.main();const o=await Promise.allSettled(Object.values(_load_promises));let n=!0;if(o.forEach(e=>{e.reason&&(console.log("ERROR: Startup Initialization error: "+e.reason),n=!1)}),!n){console.log("ERROR: Could not startup successfully, terminating");return}_load_promises={},console.log("loading finished");function s(){loopAnimationFrameId=requestAnimationFrame(s),t._on_update()}s()})</script>